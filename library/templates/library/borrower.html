{% extends 'library/base.html' %}
{% block content %}
<div class="card">
    <h2>ğŸ“– My Reading Corner</h2>

    <h3>âœ… Available Books</h3>
    {% if available %}
        <ul class="book-list">
        {% for book in available %}
            <li>
                <strong>{{ book.title }}</strong> by {{ book.author }}
                <a href="{% url 'borrow_book' book.id %}" class="btn-borrow">ğŸ“š Borrow</a>
                {% if book.pdf_file %}
                    <a href="{{ book.pdf_file.url }}" target="_blank" class="btn-review">ğŸ“„ Preview</a>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No books available right now. ğŸ˜¢</p>
    {% endif %}

    <h3>ğŸ“˜ My Borrowed Books (by Category)</h3>
    {% if categories %}
        {% for category, books in categories.items %}
            <h4>ğŸ“š {{ category }}</h4>
            <ul class="book-list">
            {% for book in books %}
                {% with record=book.borrowrecord_set.first %}
                    {% if record and not record.returned %}
                        <li>
                            <strong>{{ book.title }}</strong> by {{ book.author }}
                            <a href="{% url 'return_book' record.id %}" class="btn-return">â†©ï¸ Return</a>
                            <a href="{% url 'add_review' book.id %}" class="btn-review">â­ Rate & Note</a>
                            {% if book.pdf_file %}
                                <a href="{{ book.pdf_file.url }}" target="_blank" class="btn-review">ğŸ“„ Read PDF</a>
                            {% endif %}
                        </li>
                    {% endif %}
                {% endwith %}
            {% endfor %}
            </ul>
        {% endfor %}
    {% else %}
        <p>You havenâ€™t borrowed any books yet! ğŸŒ¸</p>
    {% endif %}
</div>
{% endblock %}